# 公钥密码Rabin

### 1. Rabin的密钥生成

选择两个大的素数p和q

要求

> p和q都是4的倍数加3

计算
$$
n=pq
$$
Bob的公钥是n，对外公布。

Bob的私钥是`（p，q）`

### 2. Rabin的加密过程

Alice欲发送明文m给Bob

> 其中 , 0<m<n 

Alice用Bob的公钥n，计算
$$
c=m^{2}(modn)
$$
c为密文

### 3. Rabin的解密过程 

Bob 收到密文c后，用自己的私钥（p，q）计算
$$
m_p = c^{\frac{p+1}{4}} (mod p)\\
m_q = c^{\frac{q+1}{4}} (mod q)
$$
这里，$m_p$和 $m_q$ 的解其实有两个（一正一负）。再利用 扩展欧几里得算法 计算出 $y_p$和  $y_q$，使得：
$$
y_pp + y_qq ≡ 1 (mod n)
$$
这样就可以根据 中国剩余定理，解出四个明文：
$$
\begin{align*}
x_1 &= y_ppm_q + y_qqm_p \  (mod \ n) \\x_2 
&= n - x_1 \\x_3 
&= y_ppm_q - y_qqm_p \  (mod \ n) \\x_4 
&= n - x_3 \\
\end{align*}
$$

> 于是，真正的明文m一定就是4个数 $m_(1,1)， m(1,2)， m(2,1)， m(2,2)$之中的一个
>

观察4个数，排除那些没有意义的“乱码课文”。哪个是有意义的课文，哪个就是真正的明文m

解密完毕。

##### 这里注意一个定理：

有初等数论里的一个知识，有，解二次同余式：
$$
x^2 ≡ n \ (mod \ p)  ,\   \  \ p是奇素数
$$
由勒让德符号可知，如果有：
$$
(\frac n p) = -1,\  \ \ 方程无解\\
(\frac n p) = 1,\ \ \ \ 方程有解
$$
定理：当$(\frac n p) = 1$时，有如果$p \equiv 3(mod4) $，则其解为$\pm n^{\frac {p-1} {4}}$。

但注意，这里指的解，是在 模数 $p$ 为素数的情况下。而本次加密的 $n$ 显然不是素数。

### 4. Rabin的安全性原理

攻击者Eve截获了密文`c `

Eve还知道Bob的公钥n，也知道明文m满足方程
$$
c=m^{2}(modn)
$$
但是在不知道n的分解式`n=pq`的情况下，求解方程 $x^2 \equiv c  (mod n)$ 是不可能的。因为无法计算 $m_p$和 $m_q$，进一步的无法计算4个根。

求n的分解式`n=pq`是大数分解问题。

这里，有定理：

>定理  设攻击者Eve截获了密文c。 则 Eve能够获得密文 c 的 4个`(modn)`平方根
>
>${m(1,1)，m(1,2)，m(2,1)，m(2,2)}$，当且仅当Eve知道n的分解式`n=pq`

如果Eve能够获得密文 c 的 4 个(modn)平方根 $\{{m(1,1)，m(1,2)，m(2,1)，m(2,2)}\}$ ，则

- m(1,1)+m(1,2)不是n的倍数却是q的倍数；

- m(1,1)+m(2,1)不是n的倍数却是p的倍数；

- m(2,2)+m(1,2)不是n的倍数却是p的倍数；

- m(2,2)+m(2,1)不是n的倍数却是q的倍数。


于是Eve可以通过求
$$
gcd(m(1,1)+m(1,2), n)
$$
知道n的分解式 $n=pq​$

***注意，这个性质，可以使用在“不经意传输协议”里面。***

---

如果知道了n的分解式 $n=pq$，则能够计算 $m_p$和 $m_q$。再由 $m_p$和 $m_q$ 计算4个根，使用的是著名的孙子定理（中国剩余定理）（略）。

最后，要判断哪一个根是真正的明文。

一般，真正的明文都具有语言含义，而其它的根则是没有语言含义的“乱码课文”。当然也有例外，比如当明文是一副图象的编码时，明文也是没有语言含义的“乱码课文”。